<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inferring and annotating metacell flows â€¢ metacell.flow</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Inferring and annotating metacell flows">
<meta property="og:description" content="Supporting inference of differentiation flow over metacell
    manifolds (and innovation of additional scRNA buzzwords)">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">metacell.flow</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="metacellflow">metacell.flow<a class="anchor" aria-label="anchor" href="#metacellflow"></a>
</h1></div>
<!-- badges: start --><!-- badges: end --><p>The goal of metacell.flow is to infer differentiation flow models from single cell RNA-seq data and metacell models representing it, with time tags per cell. Potential techniques for inferring or sampling time tags will be under invesigation. This package is still in research mode.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the released version of metacell.flow from github with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"tanaylab/metacell.flow"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/tanaylab/metacell" class="external-link">"metacell"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st">"metacell.flow"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/metacell/man/scdb_init.html" class="external-link">scdb_init</a></span><span class="op">(</span><span class="st">"scrna_db/"</span>, force_reinit<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/scdb_flow_init.html">scdb_flow_init</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">tgconfig</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tgconfig/man/override_params.html" class="external-link">override_params</a></span><span class="op">(</span><span class="st">"config/netflow.yaml"</span>,<span class="st">"metacell"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">example_leak_table_sing_emb</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">mc_id</span>, <span class="va">leak_emb_endo</span>, <span class="va">leak_exe_endo</span><span class="op">)</span> </span>
<span><span class="op">{</span></span>
<span>  <span class="va">mc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/metacell/man/scdb_mc.html" class="external-link">scdb_mc</a></span><span class="op">(</span><span class="va">mc_id</span><span class="op">)</span></span>
<span>  <span class="va">legc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log2</a></span><span class="op">(</span><span class="va">mc</span><span class="op">@</span><span class="va">e_gc</span> <span class="op">+</span> <span class="fl">1e-5</span><span class="op">)</span></span>
<span>  <span class="va">mc_leak</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">legc</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># first separation embryonic endoderm (including node/notochord) from meso/-ectoderm </span></span>
<span>  <span class="va">x1</span> <span class="op">=</span> <span class="op">-</span><span class="fl">16</span></span>
<span>  <span class="va">y1</span> <span class="op">=</span> <span class="op">-</span><span class="fl">12</span></span>
<span>  <span class="va">x2</span> <span class="op">=</span> <span class="op">-</span><span class="fl">12</span></span>
<span>  <span class="va">y2</span> <span class="op">=</span> <span class="op">-</span><span class="fl">16</span></span>
<span>  </span>
<span>  <span class="va">b_emb_endo</span> <span class="op">=</span> <span class="op">(</span><span class="va">y2</span> <span class="op">-</span> <span class="va">y1</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">x2</span> <span class="op">-</span> <span class="va">x1</span><span class="op">)</span></span>
<span>  <span class="va">a_emb_endo</span> <span class="op">=</span> <span class="op">(</span><span class="va">y1</span><span class="op">*</span><span class="va">x2</span> <span class="op">-</span> <span class="va">y2</span><span class="op">*</span><span class="va">x1</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">x2</span> <span class="op">-</span> <span class="va">x1</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">f_endo</span> <span class="op">=</span> <span class="op">(</span><span class="va">legc</span><span class="op">[</span><span class="st">"Foxa1"</span>,<span class="op">]</span>  <span class="op">&gt;</span> <span class="va">a_emb_endo</span> <span class="op">+</span> <span class="va">b_emb_endo</span><span class="op">*</span><span class="va">legc</span><span class="op">[</span><span class="st">"Foxa2"</span>,<span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">mc_leak</span><span class="op">[</span><span class="va">f_endo</span><span class="op">]</span> <span class="op">=</span> <span class="va">leak_emb_endo</span></span>
<span>  </span>
<span>  <span class="co"># second separation extraembryonic from embryonic endoderm uses Apoe</span></span>
<span>  <span class="va">x1</span> <span class="op">=</span> <span class="op">-</span><span class="fl">8.4</span></span>
<span>  <span class="va">y1</span> <span class="op">=</span> <span class="op">-</span><span class="fl">14</span></span>
<span>  <span class="va">x2</span> <span class="op">=</span> <span class="op">-</span><span class="fl">11</span></span>
<span>  <span class="va">y2</span> <span class="op">=</span> <span class="op">-</span><span class="fl">8.4</span></span>
<span>  </span>
<span>  <span class="va">b_exe_endo</span> <span class="op">=</span> <span class="op">(</span><span class="va">y2</span> <span class="op">-</span> <span class="va">y1</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">x2</span> <span class="op">-</span> <span class="va">x1</span><span class="op">)</span></span>
<span>  <span class="va">a_exe_endo</span> <span class="op">=</span> <span class="op">(</span><span class="va">y1</span><span class="op">*</span><span class="va">x2</span> <span class="op">-</span> <span class="va">y2</span><span class="op">*</span><span class="va">x1</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">x2</span> <span class="op">-</span> <span class="va">x1</span><span class="op">)</span></span>
<span>  <span class="va">f_exe</span> <span class="op">=</span> <span class="op">(</span><span class="va">legc</span><span class="op">[</span><span class="st">"Ttr"</span>,<span class="op">]</span>  <span class="op">&gt;</span> <span class="va">a_exe_endo</span> <span class="op">+</span> <span class="va">b_exe_endo</span><span class="op">*</span><span class="va">legc</span><span class="op">[</span><span class="st">"Apoe"</span>,<span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">mc_leak</span><span class="op">[</span><span class="va">f_exe</span><span class="op">]</span> <span class="op">=</span> <span class="va">leak_exe_endo</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">mc_leak</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">mc_leak</span> <span class="op">=</span> <span class="fu">example_leak_table_sing_emb</span><span class="op">(</span></span>
<span>            mc_id <span class="op">=</span> <span class="st">"sing_emb_wt10_recolored"</span>,</span>
<span>            leak_emb_endo <span class="op">=</span> <span class="fl">0.12</span>,</span>
<span>            leak_exe_endo <span class="op">=</span> <span class="fl">0.17</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">mc_leak</span><span class="op">)</span>, sep<span class="op">=</span><span class="st">"\t"</span>, quote<span class="op">=</span><span class="cn">F</span>, file<span class="op">=</span><span class="st">"scrna_db/leak.sing_emb_wt10_recolored.txt"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mat_id</span> <span class="op">=</span> <span class="st">"sing_emb_wt10"</span></span>
<span><span class="va">mc_id</span> <span class="op">=</span> <span class="st">"sing_emb_wt10_recolored"</span></span>
<span><span class="va">mgraph_id</span> <span class="op">=</span> <span class="st">"sing_emb_wt10_logist"</span></span>
<span><span class="va">net_id</span> <span class="op">=</span> <span class="st">"sing_emb_wt10_logist"</span></span>
<span></span>
<span><span class="va">mat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/metacell/man/scdb_mat.html" class="external-link">scdb_mat</a></span><span class="op">(</span><span class="va">mat_id</span><span class="op">)</span></span>
<span><span class="va">md</span> <span class="op">=</span> <span class="va">mat</span><span class="op">@</span><span class="va">cell_metadata</span></span>
<span><span class="va">cell_time</span> <span class="op">=</span> <span class="va">md</span><span class="op">[</span>,<span class="st">"age_group"</span><span class="op">]</span></span>
<span></span>
<span><span class="va">mgraph</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/metacell/man/scdb_mgraph.html" class="external-link">scdb_mgraph</a></span><span class="op">(</span><span class="va">mgraph_id</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cell_time</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">md</span><span class="op">)</span></span>
<span></span>
<span><span class="va">leak_fn</span> <span class="op">=</span> <span class="st">"scrna_db/leak.sing_emb_wt10_recolored.txt"</span></span>
<span></span>
<span><span class="fu"><a href="reference/mcell_mctnet_from_mgraph.html">mcell_mctnet_from_mgraph</a></span><span class="op">(</span><span class="va">net_id</span>, </span>
<span>                                <span class="va">mgraph_id</span>,</span>
<span>                                <span class="va">cell_time</span>,</span>
<span>                                <span class="va">leak_fn</span>,</span>
<span>                            t_exp <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                T_cost <span class="op">=</span> <span class="fl">1e+5</span>,</span>
<span>                                capacity_var_factor <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                                off_capacity_cost1 <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                off_capacity_cost2 <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                                k_norm_ext_cost <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                k_ext_norm_cost <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                k_ext_ext_cost <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co">##now generate the flow itself</span></span>
<span></span>
<span><span class="va">flow_id</span> <span class="op">=</span> <span class="st">"sing_emb_wt10_logist"</span></span>
<span><span class="va">fig_dir</span> <span class="op">=</span> <span class="st">"figs/"</span></span>
<span></span>
<span><span class="va">flow_tolerance</span> <span class="op">=</span> <span class="fl">0.01</span></span>
<span></span>
<span><span class="va">network_color_ord</span> <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"generate flows"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/mcell_new_mctnetflow.html">mcell_new_mctnetflow</a></span><span class="op">(</span><span class="va">flow_id</span>, <span class="va">net_id</span>, </span>
<span>                            init_mincost <span class="op">=</span> <span class="cn">T</span>, flow_tolerance<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"solved network flow problem"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mcf</span> <span class="op">=</span> <span class="fu"><a href="reference/scdb_mctnetflow.html">scdb_mctnetflow</a></span><span class="op">(</span><span class="va">flow_id</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co">#compute propagatation forward and background</span></span>
<span><span class="va">mcf</span> <span class="op">=</span> <span class="fu"><a href="reference/mctnetflow_comp_propagation.html">mctnetflow_comp_propagation</a></span><span class="op">(</span><span class="va">mcf</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co">#adding back the object with the network and flows</span></span>
<span><span class="fu"><a href="reference/scdb_add_mctnetflow.html">scdb_add_mctnetflow</a></span><span class="op">(</span><span class="va">flow_id</span>, <span class="va">mcf</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing metacell.flow</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Amos Tanay <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>



  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Amos Tanay.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
